<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulario de Reserva</title>
    <link rel="stylesheet" href="">
</head>
<body>

<h2>Formulario de Reserva</h2>
<form id="form-reserva" action="reserva.php" method="POST"> 
    <label for="nombre">Nombre:</label><br>
    <input type="text" id="nombre" name="nombre" required><br><br>

    <label for="apellido">Apellido:</label><br>
    <input type="text" id="apellido" name="apellido" required><br><br>

    <label for="correo">Correo Electrónico:</label><br>
    <input type="email" id="correo" name="correo" required><br><br>

    <label for="fecha">Fecha de Reserva:</label><br>
    <input type="date" id="fecha" name="fecha" required onchange="mostrarHoras()"><br><br>

    <label for="horarios">Selecciona las horas disponibles:</label><br>
    <select id="horarios" name="horarios[]" multiple required size="10" style="width: 200px;"></select><br><br>

    <div id="hora-inicio-seleccionada"></div>
    <div id="hora-fin-seleccionada"></div>

    <input type="hidden" id="hora_inicio" name="hora_inicio">
    <input type="hidden" id="hora_fin" name="hora_fin">
    <input type="submit" value="Reservar">
</form>
<script>
    // muestran las horas en el select con id horarios
    function mostrarHoras() {
    const horariosSelect = document.getElementById('horarios');
    limpiarHorasPrevias(horariosSelect); // Limpiar horas previas

    const horasDisponibles = obtenerHorasDisponibles(); // Obtener horas disponibles

    agregarHorasAlSelect(horariosSelect, horasDisponibles); // Agregar horas disponibles al select
    horariosSelect.addEventListener('change', function () {
        manejarCambioHorarios(horariosSelect);
    });
}

// Función para limpiar las horas previas del select
function limpiarHorasPrevias(selectElement) {
    selectElement.innerHTML = ''; // Limpiar horas previas
}

// Función para obtener las horas disponibles
function obtenerHorasDisponibles() {
    return [
        '09:00 - 10:00', '10:00 - 11:00', '11:00 - 12:00', '12:00 - 13:00',
        '13:00 - 14:00', '14:00 - 15:00', '15:00 - 16:00', '16:00 - 17:00',
        '17:00 - 18:00'
    ];
}

// Función para agregar horas al select
function agregarHorasAlSelect(selectElement, horasDisponibles) {
    horasDisponibles.forEach(intervalo => {
        const option = document.createElement('option');
        option.value = intervalo; // Guardar el intervalo completo
        option.textContent = intervalo; // Mostrar el intervalo completo
        selectElement.appendChild(option);
    });
}

// Función para manejar el cambio en el select de horarios
function manejarCambioHorarios(horariosSelect) {
    const selectedOptions = Array.from(horariosSelect.selectedOptions).map(option => option.value); //me crear un array con los intervalos de tiempo seleccionados

    if (selectedOptions.length > 0) {
        const { horaInicioFormateada, horaFinFormateada } = calcularHoras(selectedOptions); // me lo guarda como un obejto.

        // funcion mostrar las horas de inicio y fin
        mostrarHorasSeleccionadas(horaInicioFormateada, horaFinFormateada);

        // funcion guardar en los campos ocultos
        guardarHorasEnCamposOcultos(horaInicioFormateada, horaFinFormateada);
    } else {
        // Si no hay selección, limpiar los textos
        limpiarTextoHorasSeleccionadas();
    }
}

// Función para calcular las horas de inicio y fin a partir de las opciones seleccionadas
function calcularHoras(selectedOptions) {
    let horaInicio = null;
    let horaFin = null;

    selectedOptions.forEach(intervalo => {
        const [inicio, fin] = intervalo.split(' - '); // Separar las horas en inicio fin, ya queestan asi: 09:00 -10:00
        const horaInicioNum = parseInt(inicio.replace(':', ''), 10); // Convertir a número
        const horaFinNum = parseInt(fin.replace(':', ''), 10); // Convertir a número

        // Determinar la hora de inicio (mínima) y la hora de fin (máxima)
        if (horaInicio === null || horaInicioNum < horaInicio) {
            horaInicio = horaInicioNum; // Actualizar hora de inicio
        }
        if (horaFin === null || horaFinNum > horaFin) {
            horaFin = horaFinNum; // Actualizar hora de fin
        }
    });

    // Convertir las horas de vuelta a formato 'HH:MM'
    const horaInicioFormateada = formatearHora(horaInicio);
    const horaFinFormateada = formatearHora(horaFin);

    return { horaInicioFormateada, horaFinFormateada };
}

// Función para formatear la hora en 'HH:MM'
function formatearHora(hora) {
    // lo convierte a string, y siempre tenra 4 digitios, sino añade 0 delante
    const horaStr = String(hora).padStart(4, '0'); 

    // Extraer las horas y minutos usando substring
    const horas = horaStr.substring(0, 2); //  primeros 2 caracteres
    const minutos = horaStr.substring(2);  //  últimos 2 caracteres

    // Unir las horas y minutos en el formato HH:MM
    return `${horas}:${minutos}`;
}


// Función para mostrar las horas de inicio y fin en la interfaz
function mostrarHorasSeleccionadas(horaInicio, horaFin) {
    document.getElementById('hora-inicio-seleccionada').textContent = "Hora de inicio: " + horaInicio;
    document.getElementById('hora-fin-seleccionada').textContent = "Hora de fin: " + horaFin;
}

// Función para guardar las horas en los campos ocultos
function guardarHorasEnCamposOcultos(horaInicio, horaFin) {
    document.getElementById('hora_inicio').value = horaInicio;
    document.getElementById('hora_fin').value = horaFin;
}

// Función para limpiar los textos de horas seleccionadas
function limpiarTextoHorasSeleccionadas() {
    document.getElementById('hora-inicio-seleccionada').textContent = "";
    document.getElementById('hora-fin-seleccionada').textContent = "";
    // Restablecer campos ocultos
    document.getElementById('hora_inicio').value = '';
    document.getElementById('hora_fin').value = '';
}

</script>
</body>
</html>

</body>

</html>